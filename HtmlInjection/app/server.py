from flask import Flask, render_template, redirect, request, render_template_string
from jinja2 import Template, Markup
app = Flask(__name__)
comments = [{
    "author": "John Doe",
    "text": "Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus."
},
    {
        "author": "John Doe",
        "text": "Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus."
    }
]


@app.route("/", methods=["GET", "POST"])
def index():
    if request.method == "POST":
        username = request.form.get("username")
        text = request.form.get("comment")
        if not validate_input(username+text):
            return "You can't hack Us"
        comments.append({"author": Markup(username),
                         "text": Markup(text)})
    html = open("templates/index.html").read()
    return render_template_string(html, comments=comments)


def validate_input(data):
    data = data.lower()
    if '<img' in data:
        return False
    elif '<script' in data:
        return False
    return True

if __name__ == '__main__':
    app.run(host="0.0.0.0", port=80, debug=True)
